import{r as t,p as M,L as r,a as T,j as e,c as n,g as L,R as k,f as E}from"./index-KV9ASIHf.js";import{u as F,s as P,V as R,P as H,S as V,a as X}from"./offers-CFTgBBUv.js";import{P as O,a as D}from"./client-DjLAMc_R.js";function q({offerId:d}){const[w,p]=t.useState(!0),[i,u]=t.useState(null),[h,b]=t.useState(1e5),[I,g]=t.useState("100,000"),[m,j]=t.useState(!1),[f,A]=t.useState(null),[S,x]=t.useState(!1),[v,o]=t.useState(""),c=t.useRef(null),{enable:N,disable:y}=F();t.useEffect(()=>{async function a(){try{p(!0),c.current&&c.current.abort();const s=new AbortController;c.current=s;const l=await X(d,{signal:s.signal});if(!l){u("Offer not found");return}if(l.status==="invalid"){u("Invalid offer link");return}if(l.status==="expired"){u("Offer has expired");return}}catch(s){if(s?.name==="AbortError")return;u(s.message||"Failed to load offer")}finally{p(!1)}}return a(),()=>{c.current&&c.current.abort()}},[d]);const _=t.useCallback(a=>{const{value:s,display:l}=M(a,r);g(l),b(s),o("")},[]),C=t.useCallback(async()=>{if(!m)try{j(!0),o("");const a=Math.min(Math.max(h,r.TOTAL_MIN),r.TOTAL_MAX);if(a<r.TOTAL_MIN||a>r.TOTAL_MAX){o(`Please keep your minimum between ${T(r.TOTAL_MIN)} and ${T(r.TOTAL_MAX)}.`);return}const s=await P(d,{min:a}),l={status:s.status,finalOffer:s.final,suggested:s.suggested};if(A(l),s?.resultId){setTimeout(()=>{window.location.hash=`#result=${s.resultId}`},100);return}}catch(a){if(a?.name==="AbortError")return;o(a.message||"We could not submit your response. Please retry.")}finally{j(!1)}},[d,m,h]);return w?e.jsx(O,{className:"space-y-6 animate-[cardIn_280ms_ease-out]",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("div",{className:"h-8 bg-slate-200 rounded w-1/3 mx-auto"}),e.jsx("div",{className:"h-4 bg-slate-100 rounded w-2/3 mx-auto"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-slate-100 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-slate-200 rounded w-full"}),e.jsx("div",{className:"h-2 bg-slate-200 rounded-full w-full"})]}),e.jsx("div",{className:"h-12 bg-slate-200 rounded-full w-full"})]})}):i?e.jsxs(O,{className:"space-y-6 animate-[cardIn_280ms_ease-out]",children:[e.jsxs("header",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-slate-50 ring-4 ring-rose-100 text-4xl text-rose-600 animate-[emojiPop_260ms_ease-out]",children:e.jsx("span",{children:"‚ö†Ô∏è"})}),e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold text-slate-900",children:i==="Offer not found"?n.error.notFoundHeadline:i==="Offer has expired"?n.error.expiredHeadline:i==="Invalid offer link"?n.error.invalidHeadline:"Oops"}),e.jsx("p",{className:"text-sm md:text-base text-slate-600",children:i})]}),e.jsx("div",{className:"flex flex-col gap-3",children:e.jsx("button",{onClick:L,className:"w-full rounded-full bg-slate-900 text-white py-3 text-sm font-medium hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2 transition-all active:scale-[0.98]",children:n.error.retry})})]}):f?e.jsx(k,{status:f.status,finalOffer:f.finalOffer,suggested:f.suggested}):e.jsx("div",{className:"page-grid",children:e.jsx(D,{className:"animate-[cardIn_280ms_ease-out]",title:n.candidate.headline,"data-focus-mode":S,children:e.jsxs("div",{className:"card-flow",children:[e.jsx(R,{label:n.candidate.valueLabel,inputValue:I,onInputChange:_,onFocus:()=>{x(!0),N()},onBlur:()=>{x(!1),y()}}),e.jsx(H,{label:n.candidate.sliderLabel,value:h,min:r.TOTAL_MIN,max:r.TOTAL_MAX,step:5e3,onChange:a=>{const s=Number(a.target.value);b(s),g(E(s)),o("")},variant:"candidate",thumbEmoji:"ü™ô",onDragStart:()=>{x(!0),N()},onDragEnd:()=>{x(!1),y()}}),e.jsx("section",{className:"card-block",children:e.jsx("div",{className:"privacy-note",children:e.jsx("span",{children:n.candidate.privacy})})}),e.jsx("section",{className:"card-block card-block--cta",children:e.jsxs("div",{className:"cta-stack",children:[e.jsx(V,{text:n.candidate.cta,onConfirm:C,loading:m,disabled:m}),v&&e.jsxs("p",{className:"cta-error",role:"alert","aria-live":"polite",children:[e.jsx("span",{"aria-hidden":"true",children:"‚ö†Ô∏è"}),e.jsx("span",{children:v})]})]})})]})})})}export{q as CandidateView};
//# sourceMappingURL=CandidateView-C7n7bPnd.js.map
