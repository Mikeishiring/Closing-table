{"version":3,"file":"CandidateView-C7n7bPnd.js","sources":["../../src/views/CandidateView.jsx"],"sourcesContent":["/**\n * Candidate View\n * Where candidates respond to offers\n */\n\nimport React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport { PrimaryCard, PrimaryPanel, PrimarySlider, SlideToConfirm, ValueInputSection, ResultCard } from '../components';\nimport { getOffer, submitResponse } from '../api';\nimport { formatCurrency, LIMITS, parseMoneyInput, formatNumber } from '../lib/deal';\nimport { useFocusMode } from '../hooks';\nimport { goHome } from '../routing';\nimport { copy, EXPIRY } from '../tokens';\n\nexport function CandidateView({ offerId }) {\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [totalComp, setTotalComp] = useState(100000);\n  const [totalInput, setTotalInput] = useState('100,000');\n  const [submitting, setSubmitting] = useState(false);\n  const [result, setResult] = useState(null);\n  const [isFocusing, setIsFocusing] = useState(false);\n  const [formError, setFormError] = useState('');\n  const offerAbortRef = useRef(null);\n  const { enable: enableFocusMode, disable: disableFocusMode } = useFocusMode();\n\n  useEffect(() => {\n    async function fetchOffer() {\n      try {\n        setLoading(true);\n        // Abort any in-flight request when offerId changes\n        if (offerAbortRef.current) {\n          offerAbortRef.current.abort();\n        }\n        const controller = new AbortController();\n        offerAbortRef.current = controller;\n        const data = await getOffer(offerId, { signal: controller.signal });\n        \n        if (!data) {\n          setError('Offer not found');\n          return;\n        }\n        \n        if (data.status === 'invalid') {\n          setError('Invalid offer link');\n          return;\n        }\n        \n        if (data.status === 'expired') {\n          setError('Offer has expired');\n          return;\n        }\n      } catch (err) {\n        if (err?.name === 'AbortError') return;\n        setError(err.message || 'Failed to load offer');\n      } finally {\n        setLoading(false);\n      }\n    }\n    \n    fetchOffer();\n    return () => {\n      if (offerAbortRef.current) {\n        offerAbortRef.current.abort();\n      }\n    };\n  }, [offerId]);\n\n  const handleTotalInputChange = useCallback((val) => {\n    const { value, display } = parseMoneyInput(val, LIMITS);\n    setTotalInput(display);\n    setTotalComp(value);\n    setFormError('');\n  }, []);\n\n  const handleSubmit = useCallback(async () => {\n    if (submitting) return;\n    try {\n      setSubmitting(true);\n      setFormError('');\n      \n      const clampedTotal = Math.min(Math.max(totalComp, LIMITS.TOTAL_MIN), LIMITS.TOTAL_MAX);\n\n      // Client-side validation for sanity\n      if (clampedTotal < LIMITS.TOTAL_MIN || clampedTotal > LIMITS.TOTAL_MAX) {\n        setFormError(`Please keep your minimum between ${formatCurrency(LIMITS.TOTAL_MIN)} and ${formatCurrency(LIMITS.TOTAL_MAX)}.`);\n        return;\n      }\n      \n      const data = await submitResponse(offerId, {\n        min: clampedTotal,\n      });\n\n      // Store result in local state first (as backup)\n      const resultData = {\n        status: data.status,\n        finalOffer: data.final,\n        suggested: data.suggested,\n      };\n      setResult(resultData);\n\n      // If we have a resultId, navigate to the result view\n      if (data?.resultId) {\n        // Small delay to ensure state is set before navigation\n        setTimeout(() => {\n          window.location.hash = `#result=${data.resultId}`;\n        }, 100);\n        return;\n      }\n    } catch (err) {\n      if (err?.name === 'AbortError') return;\n      setFormError(err.message || 'We could not submit your response. Please retry.');\n    } finally {\n      setSubmitting(false);\n    }\n  }, [offerId, submitting, totalComp]);\n\n  if (loading) {\n    return (\n      <PrimaryCard className=\"space-y-6 animate-[cardIn_280ms_ease-out]\">\n        <div className=\"animate-pulse space-y-6\">\n          <div className=\"space-y-2 text-center\">\n            <div className=\"h-8 bg-slate-200 rounded w-1/3 mx-auto\" />\n            <div className=\"h-4 bg-slate-100 rounded w-2/3 mx-auto\" />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"h-4 bg-slate-100 rounded w-1/4\" />\n            <div className=\"h-10 bg-slate-200 rounded w-full\" />\n            <div className=\"h-2 bg-slate-200 rounded-full w-full\" />\n          </div>\n          <div className=\"h-12 bg-slate-200 rounded-full w-full\" />\n        </div>\n      </PrimaryCard>\n    );\n  }\n\n  if (error) {\n    return (\n      <PrimaryCard className=\"space-y-6 animate-[cardIn_280ms_ease-out]\">\n        <header className=\"flex flex-col items-center text-center space-y-3\">\n          <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-slate-50 ring-4 ring-rose-100 text-4xl text-rose-600 animate-[emojiPop_260ms_ease-out]\">\n            <span>‚ö†Ô∏è</span>\n          </div>\n          <h1 className=\"text-2xl md:text-3xl font-semibold text-slate-900\">\n            {error === 'Offer not found' ? copy.error.notFoundHeadline : \n             error === 'Offer has expired' ? copy.error.expiredHeadline : \n             error === 'Invalid offer link' ? copy.error.invalidHeadline : \n             'Oops'}\n          </h1>\n          <p className=\"text-sm md:text-base text-slate-600\">\n            {error}\n          </p>\n        </header>\n        \n        <div className=\"flex flex-col gap-3\">\n          <button\n            onClick={goHome}\n            className=\"w-full rounded-full bg-slate-900 text-white py-3 text-sm font-medium hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2 transition-all active:scale-[0.98]\"\n          >\n            {copy.error.retry}\n          </button>\n        </div>\n      </PrimaryCard>\n    );\n  }\n\n  if (result) {\n    return (\n      <ResultCard\n        status={result.status}\n        finalOffer={result.finalOffer}\n        suggested={result.suggested}\n      />\n    );\n  }\n\n  return (\n    <div className=\"page-grid\">\n      <PrimaryPanel\n        className=\"animate-[cardIn_280ms_ease-out]\"\n        title={copy.candidate.headline}\n        data-focus-mode={isFocusing}\n      >\n        <div className=\"card-flow\">\n          <ValueInputSection\n            label={copy.candidate.valueLabel}\n            inputValue={totalInput}\n            onInputChange={handleTotalInputChange}\n            onFocus={() => {\n              setIsFocusing(true);\n              enableFocusMode();\n            }}\n            onBlur={() => {\n              setIsFocusing(false);\n              disableFocusMode();\n            }}\n          />\n\n          <PrimarySlider\n            label={copy.candidate.sliderLabel}\n            value={totalComp}\n            min={LIMITS.TOTAL_MIN}\n            max={LIMITS.TOTAL_MAX}\n            step={5000}\n            onChange={(e) => {\n              const next = Number(e.target.value);\n              setTotalComp(next);\n              setTotalInput(formatNumber(next));\n              setFormError('');\n            }}\n            variant=\"candidate\"\n            thumbEmoji=\"ü™ô\"\n            onDragStart={() => {\n              setIsFocusing(true);\n              enableFocusMode();\n            }}\n            onDragEnd={() => {\n              setIsFocusing(false);\n              disableFocusMode();\n            }}\n          />\n\n          <section className=\"card-block\">\n            <div className=\"privacy-note\">\n              <span>{copy.candidate.privacy}</span>\n            </div>\n          </section>\n\n          <section className=\"card-block card-block--cta\">\n            <div className=\"cta-stack\">\n              <SlideToConfirm\n                text={copy.candidate.cta}\n                onConfirm={handleSubmit}\n                loading={submitting}\n                disabled={submitting}\n              />\n              {formError && (\n                <p className=\"cta-error\" role=\"alert\" aria-live=\"polite\">\n                  <span aria-hidden=\"true\">‚ö†Ô∏è</span>\n                  <span>{formError}</span>\n                </p>\n              )}\n            </div>\n          </section>\n        </div>\n      </PrimaryPanel>\n    </div>\n  );\n}\n"],"names":["CandidateView","offerId","loading","setLoading","useState","error","setError","totalComp","setTotalComp","totalInput","setTotalInput","submitting","setSubmitting","result","setResult","isFocusing","setIsFocusing","formError","setFormError","offerAbortRef","useRef","enableFocusMode","disableFocusMode","useFocusMode","useEffect","fetchOffer","controller","data","getOffer","err","handleTotalInputChange","useCallback","val","value","display","parseMoneyInput","LIMITS","handleSubmit","clampedTotal","formatCurrency","submitResponse","resultData","PrimaryCard","jsxs","jsx","copy","goHome","ResultCard","PrimaryPanel","ValueInputSection","PrimarySlider","e","next","formatNumber","SlideToConfirm"],"mappings":"4NAaO,SAASA,EAAc,CAAE,QAAAC,GAAW,CACzC,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAI,EACrC,CAACC,EAAOC,CAAQ,EAAIF,EAAAA,SAAS,IAAI,EACjC,CAACG,EAAWC,CAAY,EAAIJ,EAAAA,SAAS,GAAM,EAC3C,CAACK,EAAYC,CAAa,EAAIN,EAAAA,SAAS,SAAS,EAChD,CAACO,EAAYC,CAAa,EAAIR,EAAAA,SAAS,EAAK,EAC5C,CAACS,EAAQC,CAAS,EAAIV,EAAAA,SAAS,IAAI,EACnC,CAACW,EAAYC,CAAa,EAAIZ,EAAAA,SAAS,EAAK,EAC5C,CAACa,EAAWC,CAAY,EAAId,EAAAA,SAAS,EAAE,EACvCe,EAAgBC,EAAAA,OAAO,IAAI,EAC3B,CAAE,OAAQC,EAAiB,QAASC,CAAA,EAAqBC,EAAA,EAE/DC,EAAAA,UAAU,IAAM,CACd,eAAeC,GAAa,CAC1B,GAAI,CACFtB,EAAW,EAAI,EAEXgB,EAAc,SAChBA,EAAc,QAAQ,MAAA,EAExB,MAAMO,EAAa,IAAI,gBACvBP,EAAc,QAAUO,EACxB,MAAMC,EAAO,MAAMC,EAAS3B,EAAS,CAAE,OAAQyB,EAAW,OAAQ,EAElE,GAAI,CAACC,EAAM,CACTrB,EAAS,iBAAiB,EAC1B,MACF,CAEA,GAAIqB,EAAK,SAAW,UAAW,CAC7BrB,EAAS,oBAAoB,EAC7B,MACF,CAEA,GAAIqB,EAAK,SAAW,UAAW,CAC7BrB,EAAS,mBAAmB,EAC5B,MACF,CACF,OAASuB,EAAK,CACZ,GAAIA,GAAK,OAAS,aAAc,OAChCvB,EAASuB,EAAI,SAAW,sBAAsB,CAChD,QAAA,CACE1B,EAAW,EAAK,CAClB,CACF,CAEA,OAAAsB,EAAA,EACO,IAAM,CACPN,EAAc,SAChBA,EAAc,QAAQ,MAAA,CAE1B,CACF,EAAG,CAAClB,CAAO,CAAC,EAEZ,MAAM6B,EAAyBC,cAAaC,GAAQ,CAClD,KAAM,CAAE,MAAAC,EAAO,QAAAC,CAAA,EAAYC,EAAgBH,EAAKI,CAAM,EACtD1B,EAAcwB,CAAO,EACrB1B,EAAayB,CAAK,EAClBf,EAAa,EAAE,CACjB,EAAG,CAAA,CAAE,EAECmB,EAAeN,EAAAA,YAAY,SAAY,CAC3C,GAAI,CAAApB,EACJ,GAAI,CACFC,EAAc,EAAI,EAClBM,EAAa,EAAE,EAEf,MAAMoB,EAAe,KAAK,IAAI,KAAK,IAAI/B,EAAW6B,EAAO,SAAS,EAAGA,EAAO,SAAS,EAGrF,GAAIE,EAAeF,EAAO,WAAaE,EAAeF,EAAO,UAAW,CACtElB,EAAa,oCAAoCqB,EAAeH,EAAO,SAAS,CAAC,QAAQG,EAAeH,EAAO,SAAS,CAAC,GAAG,EAC5H,MACF,CAEA,MAAMT,EAAO,MAAMa,EAAevC,EAAS,CACzC,IAAKqC,CAAA,CACN,EAGKG,EAAa,CACjB,OAAQd,EAAK,OACb,WAAYA,EAAK,MACjB,UAAWA,EAAK,SAAA,EAKlB,GAHAb,EAAU2B,CAAU,EAGhBd,GAAM,SAAU,CAElB,WAAW,IAAM,CACf,OAAO,SAAS,KAAO,WAAWA,EAAK,QAAQ,EACjD,EAAG,GAAG,EACN,MACF,CACF,OAASE,EAAK,CACZ,GAAIA,GAAK,OAAS,aAAc,OAChCX,EAAaW,EAAI,SAAW,kDAAkD,CAChF,QAAA,CACEjB,EAAc,EAAK,CACrB,CACF,EAAG,CAACX,EAASU,EAAYJ,CAAS,CAAC,EAEnC,OAAIL,QAECwC,EAAA,CAAY,UAAU,4CACrB,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,wBACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,wCAAA,CAAyC,EACxDA,EAAAA,IAAC,MAAA,CAAI,UAAU,wCAAA,CAAyC,CAAA,EAC1D,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,gCAAA,CAAiC,EAChDA,EAAAA,IAAC,MAAA,CAAI,UAAU,kCAAA,CAAmC,EAClDA,EAAAA,IAAC,MAAA,CAAI,UAAU,sCAAA,CAAuC,CAAA,EACxD,EACAA,EAAAA,IAAC,MAAA,CAAI,UAAU,uCAAA,CAAwC,CAAA,CAAA,CACzD,CAAA,CACF,EAIAvC,EAEAsC,EAAAA,KAACD,EAAA,CAAY,UAAU,4CACrB,SAAA,CAAAC,EAAAA,KAAC,SAAA,CAAO,UAAU,mDAChB,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,oJACb,SAAAA,MAAC,OAAA,CAAK,cAAE,CAAA,CACV,QACC,KAAA,CAAG,UAAU,oDACX,SAAAvC,IAAU,kBAAoBwC,EAAK,MAAM,iBACzCxC,IAAU,oBAAsBwC,EAAK,MAAM,gBAC3CxC,IAAU,qBAAuBwC,EAAK,MAAM,gBAC5C,OACH,EACAD,EAAAA,IAAC,IAAA,CAAE,UAAU,sCACV,SAAAvC,CAAA,CACH,CAAA,EACF,EAEAuC,EAAAA,IAAC,MAAA,CAAI,UAAU,sBACb,SAAAA,EAAAA,IAAC,SAAA,CACC,QAASE,EACT,UAAU,sOAET,WAAK,MAAM,KAAA,CAAA,CACd,CACF,CAAA,EACF,EAIAjC,EAEA+B,EAAAA,IAACG,EAAA,CACC,OAAQlC,EAAO,OACf,WAAYA,EAAO,WACnB,UAAWA,EAAO,SAAA,CAAA,EAMtB+B,EAAAA,IAAC,MAAA,CAAI,UAAU,YACb,SAAAA,EAAAA,IAACI,EAAA,CACC,UAAU,kCACV,MAAOH,EAAK,UAAU,SACtB,kBAAiB9B,EAEjB,SAAA4B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAC,EAAAA,IAACK,EAAA,CACC,MAAOJ,EAAK,UAAU,WACtB,WAAYpC,EACZ,cAAeqB,EACf,QAAS,IAAM,CACbd,EAAc,EAAI,EAClBK,EAAA,CACF,EACA,OAAQ,IAAM,CACZL,EAAc,EAAK,EACnBM,EAAA,CACF,CAAA,CAAA,EAGFsB,EAAAA,IAACM,EAAA,CACC,MAAOL,EAAK,UAAU,YACtB,MAAOtC,EACP,IAAK6B,EAAO,UACZ,IAAKA,EAAO,UACZ,KAAM,IACN,SAAWe,GAAM,CACf,MAAMC,EAAO,OAAOD,EAAE,OAAO,KAAK,EAClC3C,EAAa4C,CAAI,EACjB1C,EAAc2C,EAAaD,CAAI,CAAC,EAChClC,EAAa,EAAE,CACjB,EACA,QAAQ,YACR,WAAW,KACX,YAAa,IAAM,CACjBF,EAAc,EAAI,EAClBK,EAAA,CACF,EACA,UAAW,IAAM,CACfL,EAAc,EAAK,EACnBM,EAAA,CACF,CAAA,CAAA,EAGFsB,MAAC,UAAA,CAAQ,UAAU,aACjB,eAAC,MAAA,CAAI,UAAU,eACb,SAAAA,EAAAA,IAAC,OAAA,CAAM,SAAAC,EAAK,UAAU,OAAA,CAAQ,EAChC,EACF,QAEC,UAAA,CAAQ,UAAU,6BACjB,SAAAF,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAC,EAAAA,IAACU,EAAA,CACC,KAAMT,EAAK,UAAU,IACrB,UAAWR,EACX,QAAS1B,EACT,SAAUA,CAAA,CAAA,EAEXM,UACE,IAAA,CAAE,UAAU,YAAY,KAAK,QAAQ,YAAU,SAC9C,SAAA,CAAA2B,EAAAA,IAAC,OAAA,CAAK,cAAY,OAAO,SAAA,KAAE,EAC3BA,EAAAA,IAAC,QAAM,SAAA3B,CAAA,CAAU,CAAA,CAAA,CACnB,CAAA,CAAA,CAEJ,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,EAEJ,CAEJ"}