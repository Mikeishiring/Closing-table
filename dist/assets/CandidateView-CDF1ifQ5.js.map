{"version":3,"file":"CandidateView-CDF1ifQ5.js","sources":["../../src/views/CandidateView.jsx"],"sourcesContent":["/**\r\n * Candidate View\r\n * Where candidates respond to offers\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { SignatureSlider } from '../components/SignatureSlider';\r\nimport { AnimatedSubmitButton } from '../components/AnimatedSubmitButton';\r\nimport { getOffer, generateResultLink } from '../lib/api';\r\nimport { formatCurrency } from '../lib/deal-math';\r\nimport { ResultCard } from '../components/ResultCard';\r\n\r\nexport function CandidateView({ offerId }) {\r\n  const [offer, setOffer] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [baseMin, setBaseMin] = useState(100000);\r\n  const [equityMin, setEquityMin] = useState(0);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [result, setResult] = useState(null);\r\n\r\n  useEffect(() => {\r\n    async function fetchOffer() {\r\n      try {\r\n        setLoading(true);\r\n        const data = await getOffer(offerId);\r\n        \r\n        if (!data) {\r\n          setError('Offer not found');\r\n          return;\r\n        }\r\n        \r\n        if (data.status === 'invalid') {\r\n          setError('Invalid offer link');\r\n          return;\r\n        }\r\n        \r\n        if (data.status === 'expired') {\r\n          setError('Offer has expired');\r\n          return;\r\n        }\r\n        \r\n        setOffer(data);\r\n      } catch (err) {\r\n        setError(err.message || 'Failed to load offer');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    \r\n    fetchOffer();\r\n  }, [offerId]);\r\n\r\n  const handleSubmit = async () => {\r\n    try {\r\n      setSubmitting(true);\r\n      \r\n      const response = await fetch(`http://localhost:3000/api/offers/${offerId}/submit`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          candidateBaseMin: baseMin,\r\n          candidateEquityMin: offer.equityEnabled ? equityMin : 0,\r\n        }),\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to submit response');\r\n      }\r\n      \r\n      // Calculate gap percentage for display\r\n      let gapPercent = null;\r\n      if (data.status === 'close') {\r\n        gapPercent = 8; // Approximate, within bridge zone\r\n      } else if (data.status === 'fail') {\r\n        gapPercent = 15; // Approximate, above bridge zone\r\n      }\r\n      \r\n      setResult({\r\n        status: data.status,\r\n        finalOffer: data.final,\r\n        suggested: data.suggested,\r\n        gapPercent,\r\n        resultId: data.resultId,\r\n      });\r\n    } catch (err) {\r\n      alert('Error submitting response: ' + err.message);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"bg-white rounded-3xl p-6 md:p-8 shadow-xl animate-[cardIn_280ms_ease-out]\">\r\n        <div className=\"animate-pulse space-y-6\">\r\n          <div className=\"space-y-2\">\r\n            <div className=\"h-8 bg-slate-200 rounded w-1/3 mx-auto\" />\r\n            <div className=\"h-4 bg-slate-100 rounded w-2/3 mx-auto\" />\r\n          </div>\r\n          <div className=\"space-y-2\">\r\n            <div className=\"h-4 bg-slate-100 rounded w-1/4\" />\r\n            <div className=\"h-10 bg-slate-200 rounded w-full\" />\r\n            <div className=\"h-2 bg-slate-200 rounded-full w-full\" />\r\n          </div>\r\n          <div className=\"h-12 bg-slate-200 rounded-full w-full\" />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-white rounded-3xl p-6 md:p-8 shadow-xl animate-[cardIn_280ms_ease-out]\">\r\n        <header className=\"flex flex-col items-center text-center\">\r\n          <div className=\"mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-slate-50 ring-4 ring-rose-100 text-4xl text-rose-600 animate-[emojiPop_260ms_ease-out]\">\r\n            <span>⚠️</span>\r\n          </div>\r\n          <h1 className=\"text-2xl md:text-3xl font-semibold text-slate-900\">\r\n            Oops\r\n          </h1>\r\n          <p className=\"mt-2 text-sm md:text-base text-slate-600\">\r\n            {error}\r\n          </p>\r\n        </header>\r\n        \r\n        <div className=\"mt-6\">\r\n          <button\r\n            onClick={() => window.location.hash = ''}\r\n            className=\"w-full rounded-full bg-slate-900 text-white py-3 text-sm font-medium hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2 transition-all active:scale-[0.98]\"\r\n          >\r\n            Go to home\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (result) {\r\n    return (\r\n      <ResultCard\r\n        status={result.status}\r\n        finalOffer={result.finalOffer}\r\n        suggested={result.suggested}\r\n        gapPercent={result.gapPercent}\r\n        resultId={result.resultId}\r\n      />\r\n    );\r\n  }\r\n\r\n  const totalMin = baseMin + (offer.equityEnabled ? equityMin : 0);\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-3xl p-6 md:p-8 shadow-xl animate-[cardIn_280ms_ease-out]\">\r\n      <div className=\"inline-flex items-center justify-center px-3 py-1 mb-3 rounded-full bg-[#E6F9FA] text-xs font-medium text-[#007C80]\">\r\n        Candidate view\r\n      </div>\r\n      <h2 className=\"text-2xl font-semibold mb-2\">Candidate View</h2>\r\n      <p className=\"text-slate-600 mb-2\">\r\n        Enter your minimum acceptable offer. The company will never see this number.\r\n      </p>\r\n\r\n      {/* Privacy note */}\r\n      <div className=\"mb-6 inline-flex items-center gap-2 text-sm text-[#555]\">\r\n        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n          <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n        </svg>\r\n        <span>We only show the final number, never your inputs.</span>\r\n      </div>\r\n\r\n      {/* Progress header */}\r\n      <div className=\"mb-6 flex items-center justify-center gap-2 text-xs\">\r\n        <div className=\"flex items-center gap-1\">\r\n          <div className=\"flex h-6 w-6 items-center justify-center rounded-full bg-emerald-500 text-white font-semibold\">\r\n            ✓\r\n          </div>\r\n          <span className=\"font-medium text-emerald-600\">Set Minimum</span>\r\n        </div>\r\n        <div className=\"h-px w-8 bg-emerald-500\" />\r\n        <div className=\"flex items-center gap-1\">\r\n          <div className=\"flex h-6 w-6 items-center justify-center rounded-full bg-slate-900 text-white font-semibold\">\r\n            2\r\n          </div>\r\n          <span className=\"font-semibold text-slate-900\">Submit</span>\r\n        </div>\r\n        <div className=\"h-px w-8 bg-slate-300\" />\r\n        <div className=\"flex items-center gap-1\">\r\n          <div className=\"flex h-6 w-6 items-center justify-center rounded-full bg-slate-200 text-slate-500 font-semibold\">\r\n            3\r\n          </div>\r\n          <span className=\"text-slate-500\">See Result</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-6 mb-8\">\r\n        {/* Base Salary */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n            Minimum Base Salary\r\n          </label>\r\n          <div className=\"text-3xl font-bold mb-4\">\r\n            {formatCurrency(baseMin)}\r\n          </div>\r\n          <SignatureSlider\r\n            value={baseMin}\r\n            min={50000}\r\n            max={300000}\r\n            step={5000}\r\n            onChange={(e) => setBaseMin(Number(e.target.value))}\r\n            variant=\"candidate\"\r\n            label=\"Candidate minimum base\"\r\n          />\r\n        </div>\r\n\r\n        {/* Equity */}\r\n        {offer.equityEnabled && (\r\n          <div className=\"animate-slideDown\">\r\n            <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n              Minimum Equity (Annual Value)\r\n            </label>\r\n            <div className=\"text-3xl font-bold mb-4\">\r\n              {formatCurrency(equityMin)}\r\n            </div>\r\n            <SignatureSlider\r\n              value={equityMin}\r\n              min={0}\r\n              max={200000}\r\n              step={5000}\r\n              onChange={(e) => setEquityMin(Number(e.target.value))}\r\n              variant=\"candidate\"\r\n              label=\"Candidate minimum equity\"\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {/* Total */}\r\n        <div className=\"pt-4 border-t border-slate-200\">\r\n          <div className=\"flex justify-between items-center\">\r\n            <span className=\"text-sm font-medium text-slate-700\">Total Minimum</span>\r\n            <span className=\"text-2xl font-bold text-slate-900\">{formatCurrency(totalMin)}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <AnimatedSubmitButton\r\n        onClick={handleSubmit}\r\n        buttonText=\"Lock it in & See Result\"\r\n        disabled={submitting}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["CandidateView","offerId","offer","setOffer","useState","loading","setLoading","error","setError","baseMin","setBaseMin","equityMin","setEquityMin","submitting","setSubmitting","result","setResult","useEffect","fetchOffer","data","getOffer","err","handleSubmit","response","gapPercent","jsxs","jsx","ResultCard","totalMin","formatCurrency","SignatureSlider","e","AnimatedSubmitButton"],"mappings":"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"}